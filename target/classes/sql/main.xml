<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hk.whome.main.sql">

<select id="selectImgList" parameterType = "com.hk.whome.domain.HomeListDomain" resultType="hashmap"> 
 
             SELECT A.HOME_ID        /*집 ID*/
			      ,A.USR_ID         /*사용자 ID*/
			      ,A.HOME_ADD_1       /*집 주소*/
			      ,A.HOME_ADD_2       /*집 나머지 주소*/
			      ,A.HOME_COMM      /*집 설명*/
			      ,A.HIGH_AMT       /*성수기 가격*/
			      ,A.ROW_AMT        /*비성수기 가격*/
			      ,A.HOME_RSV_CNT   /*예약수*/
			      ,A.HOME_VI_CNT    /*조회수*/
			      ,A.HOME_MOD_DT    /*집 수정일*/
			      ,A.HOME_INT_DT    /*집 저장일*/
			      ,B.HOME_IMG_PATH  /*집 이미지 경로*/
			      ,B.IMG_KEY        /*이미지 KEY*/
			  FROM TBL_HOME_INF A   /*집 정보 테이블*/
			      ,TBL_HOME_IMG B   /*집 이미지 테이블*/
			 WHERE A.HOME_ID = B.HOME_ID
               <if test = "homeAdd != null and homeAdd != ''">
				AND HOME_ADD_1 like '%'||#{homeAdd}||'%'
               </if>
               <if test = "homeDateIn != null and homeDateIn != ''  and homeDateOut != null  and homeDateOut != ''"> 
               AND A.HOME_ID NOT IN(   SELECT C.HOME_ID
                                         FROM TBL_RSV_INF C
                                        WHERE C.END_DT   <![CDATA[>=   ]]>  #{homeDateIn}
                                          AND C.STR_DT <![CDATA[ <= ]]> #{homeDateOut}
                                    )
               </if>
               <if test = "homeGuest != null and homeGuest != ''">
               AND A.HOME_GUEST >= #{homeGuest}
               </if>
               
			   AND B.MA_IMG_YN = 'Y'
 
</select>


	
	<select id="selectDetailHome" parameterType="hashmap" resultType="hashmap"> 
  <![CDATA[ 
	SELECT D.HOME_ID --집 ID
       ,D.HOME_IMG_PATH1 -- 집 이미지 경로1
       ,D.HOME_IMG_PATH2 -- 집 이미지 경로2
       ,D.HOME_IMG_PATH3 -- 집 이미지 경로3
       ,D.HOME_IMG_PATH4 -- 집 이미지 경로4
       ,D.HOME_IMG_PATH5 -- 집 이미지 경로5
       ,E.USR_ID -- 사용자 ID
       ,E.HOME_TITLE -- 집 제목
       ,E.HOME_ADD_1 -- 주소1
       ,E.MAX_GUEST -- 최대인원수
       ,E.BED_CNT -- 침대 수
       ,E.BATHROOM_CNT -- 욕실 수
       ,E.HOME_COMM --집 내용
       ,DECODE(E.HOME_RANGE,'1','집 전체','2','개인실','3','다인실','')AS HOME_RANGE --집 유형 1:집 전체  2:개인실  3:다인실 
       ,E.IS_ONLY_GUEST -- 단독인지 주인도 함께인지
FROM TBL_HOME_INF E
     ,(SELECT MAX(C.HOME_IMG_PATH1)AS HOME_IMG_PATH1 
             , MAX(C.HOME_IMG_PATH2)AS HOME_IMG_PATH2
             , MAX(C.HOME_IMG_PATH3)AS HOME_IMG_PATH3
             , MAX(C.HOME_IMG_PATH4)AS HOME_IMG_PATH4
             , MAX(C.HOME_IMG_PATH5)AS HOME_IMG_PATH5
             , C.HOME_ID
         FROM(
            SELECT CASE B.RNUM WHEN 1 THEN B.HOME_IMG_PATH END AS HOME_IMG_PATH1
                  ,CASE B.RNUM WHEN 2 THEN B.HOME_IMG_PATH END AS HOME_IMG_PATH2 
                  ,CASE B.RNUM WHEN 3 THEN B.HOME_IMG_PATH END AS HOME_IMG_PATH3 
                  ,CASE B.RNUM WHEN 4 THEN B.HOME_IMG_PATH END AS HOME_IMG_PATH4
                  ,CASE B.RNUM WHEN 5 THEN B.HOME_IMG_PATH END AS HOME_IMG_PATH5
                  ,B.HOME_ID
            FROM(
                SELECT ROW_NUMBER()OVER (PARTITION BY A.HOME_ID ORDER BY A.HOME_IMG_PATH) RNUM
                    ,A.HOME_IMG_PATH
                    ,A.HOME_ID
                  FROM TBL_HOME_IMG A
                 WHERE A.HOME_ID = #{homeId}
                   AND A.DEL_YN = 'N'
              ORDER BY A.HOME_IMG_IDX ASC) B )C
        GROUP BY C.HOME_ID) D
    WHERE D.HOME_ID =E.HOME_ID
   ]]> 
</select>
 	
<select id="selectPostscriptList" parameterType="hashmap" resultType="hashmap"> 
  <![CDATA[ 
	SELECT B.RNUM 
      ,B.HOME_ID
      ,B.USR_ID
      ,B.RVI_COMM_ID
      ,B.RVI_COMM
	FROM ( 
	SELECT ROWNUM AS RNUM
	      ,A.HOME_ID
	      ,A.USR_ID
	      ,A.RVI_COMM_ID
	      ,A.RVI_COMM
	FROM TBL_RVI_COMM A
	WHERE A.HOME_ID = #{homeId}
	ORDER BY A.RVL_COMM_INT_DT ASC
	) B
	WHERE B.RNUM BETWEEN #{startPag} AND #{endPag}
   ]]> 
</select> 	
 	
   
</mapper>